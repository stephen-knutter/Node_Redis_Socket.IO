<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Socket.IO Namespaces</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script type="text/javascript" src="socket.io.js"></script>
    <style>
      .areas { float: left; width: 50%; }
    </style>
  </head>
  <body>
    <div class="input">
      <input type="text" id="username" />
    </div>
    <div class="areas default">
      Default
      <button class="join">Join</button>
      <button class="ping">Ping</button>
      <div>
        Users
        <ul class="users">

        </ul>
      </div>
      <div>
        Events
        <ul class="events">

        </ul>
      </div>
    </div>
    <div class="areas vip">
      VIP
      <button class="join">Join</button>
      <button class="ping">Ping</button>
      <div>
        Users
        <ul class="users">

        </ul>
      </div>
      <div>
        Events
        <ul class="events">

        </ul>
      </div>
    </div>
    <script type="text/javascript">
      var socket = io.connect('http://localhost:4000');
      var vip = io.connect('http://localhost:4000/vip');

      var defaultArea = $('.default');
      var vipArea = $('.vip');
      var $username = $('#username');

      function createButton(user) {
        return '<li>' + user.username + '<button class="private_ping" data-socket="' + user.socket + '">Ping Me</button></li>';
      }

      function wireEvents(area, room) {
        var users = area.find('.users');
        var events = area.find('.events');

        area.on('click', function(e) {
          if (e.target.className === 'join') {
            socket.emit('join', {username: $username.val(), room: room});
          } else if (e.target.className === 'ping') {
            socket.emit('ping', {room: room});
          } else if (e.target.className === 'private_ping') {
            socket.emit('privatePing', {socket: e.target.getAttribute('data-socket'), room: room});
          }
        });

        socket.on('join', function(user) {
          if (user.room === room)
            users.append(createButton(user));
        });
        socket.on('ping', function(user) {
          if (user.room === room) {
            if (user.priv === undefined) {
              events.append('<li>Ping from ' + user.username + '</li>');
            } else {
              events.append('<li>Ping from ' + user.username + ' sent directly to you.</li>')
            }
          }
        });
      }

      wireEvents(defaultArea, '');
      wireEvents(vipArea, 'vip');
    </script>
  </body>
</html>
